<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">

<!--
This element provides the ability of controlling css classes depending if your element is on/off sight on the device's screen...
simply put your markup inside `<utils-animation>` and add `data-animate` attribute on elements you want animate

Example:

    <style>
      .shown { visibility: visible; }
      .hidden { visibility: hidden; }
      .utils-animatable { transition: 1s; }
    </style>

    <utils-animation>
      <h1 data-animate>Hi</h1>
    </utils-animation>

@group Seed Elements
@element utils-animation
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="utils-animation">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>
    <content></content>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'utils-animation',
    properties: {
      /**
       * Every element with attribute `data-animatable` will automatically have `utils-animatable` class
       */
      animatableClass: {value: 'utils-animatable', type: String},
      /**
       * When your element is visible on device screen, shownClass will be added to your element
       */
      shownClass: {value: 'shown', type: String},
      /**
       * When your element gets off sight, hiddenClass will be added to your element
       */
      hiddenClass: {value: 'hidden', type: String},
      /**
       * Full provides looping behaviour, don't matter how many times your element is on/off sight
       */
      full: {value: false, type: Boolean}
    },
    ready: function() {
      var self = this;
      var elm = this.querySelectorAll('[data-animate]');

      for (var i = 0; i < elm.length; i++) {
        elm[i].classList.add(self.animatableClass);
        elm[i].classList.add(self.hiddenClass);
      }

      var isVisible = function(elm) {
        var pos = (elm.offsetTop + elm.offsetHeight / 2) - window.scrollY;
        return pos > 0 && pos < window.innerHeight;
      };

      var applyShownClass = function(elm) {
        elm.classList.remove(self.hiddenClass);
        elm.classList.add(self.shownClass);
      };

      var applyHiddenClass = function(elm) {
        elm.classList.add(self.hiddenClass);
        elm.classList.remove(self.shownClass);
      };

      var onScroll;
      if (self.full) {
        onScroll = function () {
          for (var i = 0; i < elm.length; i++) {
            if (isVisible(elm[i])) {
              applyShownClass(elm[i]);
            } else {
              applyHiddenClass(elm[i]);
            }
          }
        };
      } else {
        onScroll = function () {
          for (var i = 0; i < elm.length; i++) {
            isVisible(elm[i]) && applyShownClass(elm[i]);
          }
        };
      }

      window.addEventListener('scroll', onScroll);
      onScroll();
    }
  });
</script>